{% extends "base.html" %}

{% block content %}
<div class="container my-5">
    <div class="row">
        <div class="col-md-12">
            <h1 class="text-center arewa-text-green mb-4 fw-bold">Admin Dashboard</h1>
            
            <ul class="nav nav-tabs nav-justified mb-4" id="adminTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <a class="nav-link active" id="vendors-tab" data-bs-toggle="tab" href="#vendors" role="tab" aria-controls="vendors" aria-selected="true">
                        <i class="fas fa-users-cog me-2"></i>Vendors
                    </a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link" id="snacks-tab" data-bs-toggle="tab" href="#snacks" role="tab" aria-controls="snacks" aria-selected="false">
                        <i class="fas fa-cookie-bite me-2"></i>Snacks
                    </a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link" id="ads-tab" data-bs-toggle="tab" href="#ads" role="tab" aria-controls="ads" aria-selected="false">
                        <i class="fas fa-bullhorn me-2"></i>Ads
                    </a>
                </li>
            </ul>

            <div class="tab-content" id="adminTabsContent">
                
                <div class="tab-pane fade show active" id="vendors" role="tabpanel" aria-labelledby="vendors-tab">
                    <h2 class="mb-3">Manage Vendors</h2>
                    <div class="table-responsive arewa-card p-3 shadow-sm">
                        <table class="table table-dark table-striped table-hover rounded-3 overflow-hidden">
                            <thead>
                                <tr>
                                    <th>Business Name</th>
                                    <th>Contact</th>
                                    <th>Email</th>
                                    <th>Location</th>
                                    <th>Verified</th>
                                    <th>Admin</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for vendor in vendors %}
                                <tr>
                                    <td>{{ vendor.business_name }}</td>
                                    <td>{{ vendor.contact_name }}</td>
                                    <td>{{ vendor.email }}</td>
                                    <td>{{ vendor.location_zone }}</td>
                                    <td>
                                        {% if vendor.is_verified %}
                                            <span class="badge text-bg-success rounded-pill">Yes</span>
                                        {% else %}
                                            <span class="badge text-bg-danger rounded-pill">No</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if vendor.is_admin %}
                                            <span class="badge text-bg-info rounded-pill">Yes</span>
                                        {% else %}
                                            <span class="badge text-bg-secondary rounded-pill">No</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if not vendor.is_admin %}
                                        <div class="d-flex flex-wrap gap-2">
                                            {% if not vendor.is_verified %}
                                            <form method="POST" action="{{ url_for('main.verify_vendor', vendor_id=vendor.id) }}">
                                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                                <button type="submit" class="btn btn-sm btn-success rounded-pill">Verify</button>
                                            </form>
                                            {% endif %}
                                            <a href="{{ url_for('main.admin_edit_vendor', vendor_id=vendor.id) }}" class="btn btn-sm btn-info rounded-pill">Edit</a>
                                            <form method="POST" action="{{ url_for('main.admin_delete_vendor', vendor_id=vendor.id) }}" onsubmit="return confirm('Are you sure you want to delete this vendor?');">
                                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                                <button type="submit" class="btn btn-sm btn-danger rounded-pill">Delete</button>
                                            </form>
                                        </div>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="tab-pane fade" id="snacks" role="tabpanel" aria-labelledby="snacks-tab">
                    <h2 class="mb-3">Manage Snacks</h2>
                    <div class="table-responsive arewa-card p-3 shadow-sm">
                        <table class="table table-dark table-striped table-hover rounded-3 overflow-hidden">
                            <thead>
                                <tr>
                                    <th>Snack Name</th>
                                    <th>Vendor</th>
                                    <th>Price</th>
                                    <th>Date Posted</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for snack in all_snacks %}
                                <tr>
                                    <td>{{ snack.name }}</td>
                                    <td><a href="{{ url_for('main.vendor_profile', vendor_id=snack.vendor.id) }}" class="text-white text-decoration-none">{{ snack.vendor.business_name }}</a></td>
                                    <td>â‚¦{{ snack.price | round(2) }}</td>
                                    <td>{{ snack.date_posted.strftime('%Y-%m-%d') }}</td>
                                    <td>
                                        <div class="d-flex flex-wrap gap-2">
                                            <a href="{{ url_for('main.admin_edit_snack', snack_id=snack.id) }}" class="btn btn-sm btn-info rounded-pill">Edit</a>
                                            <form method="POST" action="{{ url_for('main.admin_delete_snack', snack_id=snack.id) }}" onsubmit="return confirm('Are you sure you want to delete this snack?');">
                                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                                <button type="submit" class="btn btn-sm btn-danger rounded-pill">Delete</button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="tab-pane fade" id="ads" role="tabpanel" aria-labelledby="ads-tab">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2>Manage Ads</h2>
                        <a href="{{ url_for('main.add_ad') }}" class="btn btn-arewa-primary rounded-pill">Add New Ad</a>
                    </div>
                    <div class="table-responsive arewa-card p-3 shadow-sm">
                        <table class="table table-dark table-striped table-hover rounded-3 overflow-hidden">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Content</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for ad in all_ads %}
                                <tr>
                                    <td>{{ ad.title }}</td>
                                    <td>{{ ad.content }}</td>
                                    <td>
                                        {% if ad.is_active %}
                                            <span class="badge text-bg-success rounded-pill">Active</span>
                                        {% else %}
                                            <span class="badge text-bg-danger rounded-pill">Inactive</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="d-flex flex-wrap gap-2">
                                            <a href="{{ url_for('main.edit_ad', ad_id=ad.id) }}" class="btn btn-sm btn-info rounded-pill">Edit</a>
                                            <form method="POST" action="{{ url_for('main.toggle_ad_status', ad_id=ad.id) }}">
                                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                                <button type="submit" class="btn btn-sm btn-warning rounded-pill">
                                                    {% if ad.is_active %}Deactivate{% else %}Activate{% endif %}
                                                </button>
                                            </form>
                                            <form method="POST" action="{{ url_for('main.delete_ad', ad_id=ad.id) }}" onsubmit="return confirm('Are you sure you want to delete this ad?');">
                                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                                <button type="submit" class="btn btn-sm btn-danger rounded-pill">Delete</button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
{% endblock %}